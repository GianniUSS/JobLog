<!DOCTYPE html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>JobLOG</title>

<!-- PWA Meta Tags -->
<meta name="application-name" content="JobLog">
<meta name="description" content="Gestione timer e attivit√† per progetti Rentman">
<meta name="theme-color" content="#0ea5e9">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="JobLog">

<!-- PWA Manifest -->
<link rel="manifest" href="/static/manifest.json">

<!-- PWA Icons -->
<link rel="icon" type="image/svg+xml" sizes="192x192" href="/static/icons/icon-192x192.svg">
<link rel="icon" type="image/svg+xml" sizes="512x512" href="/static/icons/icon-512x512.svg">
<link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon-192x192.svg">

<link rel="preconnect" href="/static/js/app.js?v=20251113a" />
<style>
:root { --brand:#0078d7; --ok:#28a745; --warn:#dc3545; --bg:#f2f4f7; --header-height:68px; --project-bar-offset:calc(var(--header-height) + 12px); }
body { font-family: Arial, sans-serif; background: var(--bg); margin: 0; padding: 0; }
body.modal-open, body.menu-open { overflow: hidden; }
header { background: var(--brand); color: white; padding: 12px 20px; font-size: 18px; display: flex; justify-content: space-between; align-items: center; gap: 16px; position: sticky; top: 0; z-index: 220; box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
.header-left { display:flex; align-items:center; gap:12px; }
.logo-title { font-weight: 600; font-size: 18px; letter-spacing: 0.4px; }
.header-actions { display: flex; align-items: center; gap: 12px; }
.header-icon-btn { width:44px; height:44px; border:none; border-radius:12px; background:rgba(255,255,255,0.12); color:white; font-size:20px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:background 0.2s ease; }
.header-icon-btn:active { background:rgba(255,255,255,0.28); }
.menu-overlay { position:fixed; inset:0; background:rgba(32,33,36,0.32); z-index:210; }
.side-menu { position:fixed; top:0; left:0; height:100vh; width:320px; max-width:92vw; background:#ffffff; z-index:220; box-shadow:2px 0 24px rgba(32,33,36,0.18); padding:24px 20px; display:flex; flex-direction:column; gap:24px; transform:translateX(-105%); transition:transform 0.24s ease; }
.side-menu.open { transform:translateX(0); }
.side-menu-header { display:flex; align-items:center; justify-content:space-between; }
.side-menu-brand { display:flex; align-items:center; gap:14px; }
.side-menu-avatar { width:48px; height:48px; border-radius:50%; background:#1a73e8; color:#ffffff; display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:600; }
.side-menu-brand-text { display:flex; flex-direction:column; gap:2px; }
.side-menu-title { font-size:18px; font-weight:600; color:#202124; }
.side-menu-subtitle { font-size:13px; color:#5f6368; }
.side-menu-brand-text .side-menu-release-chip { margin-top:8px; }
.side-menu-close { border:none; border-radius:50%; background:transparent; color:#5f6368; width:40px; height:40px; font-size:20px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:background 0.2s ease, color 0.2s ease; }
.side-menu-close:active { background:rgba(66,133,244,0.12); color:#1a73e8; }
.side-menu-body { flex:1; display:flex; flex-direction:column; gap:24px; overflow-y:auto; padding-right:4px; }
.side-menu-section { display:flex; flex-direction:column; gap:10px; }
.side-menu-section-title { font-size:12px; font-weight:600; text-transform:uppercase; letter-spacing:0.8px; color:#5f6368; margin:0 0 4px 4px; }
.side-menu-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; }
.side-menu-item { border:none; border-radius:16px; padding:12px 16px; background:transparent; color:#202124; font-size:15px; font-weight:600; text-align:left; cursor:pointer; transition:background 0.2s ease, color 0.2s ease; display:flex; align-items:center; gap:16px; }
.side-menu-item:active, .side-menu-item:focus { background:#e8f0fe; color:#174ea6; outline:none; }
.side-menu-item-icon { width:36px; height:36px; border-radius:50%; background:#f1f3f4; display:flex; align-items:center; justify-content:center; font-size:18px; color:#5f6368; }
.side-menu-item:active .side-menu-item-icon, .side-menu-item:focus .side-menu-item-icon { background:#d2e3fc; color:#174ea6; }
.side-menu-item-label { flex:1; display:flex; flex-direction:column; gap:2px; }
.side-menu-item-text { font-weight:600; }
.side-menu-item-hint { font-size:12px; color:#5f6368; font-weight:400; }
.side-menu-release-chip { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:14px; background:#e8f0fe; color:#174ea6; font-size:13px; font-weight:600; text-transform:none; letter-spacing:0.4px; width:fit-content; }
.side-menu-release-dot { width:10px; height:10px; border-radius:50%; background:#1a73e8; }
.side-menu-release { font-family:"Courier New", monospace; font-size:15px; font-weight:700; color:#174ea6; letter-spacing:0.4px; text-transform:none; }
.container { padding: 12px 20px; }
.hidden { display: none !important; }
.btn:disabled { opacity: 0.55; cursor: not-allowed; }
.project-bar { background:white; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:16px; margin-bottom:20px; display:flex; flex-wrap:wrap; gap:14px; align-items:flex-start; justify-content:space-between; position: sticky; top: var(--project-bar-offset); z-index: 180; }
.project-info { display:flex; gap:12px; align-items:flex-start; font-size:16px; font-weight:bold; color:#183153; }
.project-info-icon { white-space:nowrap; }
.project-info-details { display:flex; flex-direction:column; gap:6px; font-weight:500; }
.project-metric { display:flex; align-items:center; gap:8px; font-size:14px; font-weight:600; color:#1f2937; }
.project-metric .metric-label { text-transform:uppercase; letter-spacing:0.4px; font-size:12px; color:#475569; }
.project-metric .metric-value { font-family:"Courier New", monospace; font-size:20px; font-weight:700; color:#0f172a; }
.project-actions { display:flex; gap:18px; flex-wrap:wrap; align-items:flex-start; }
.project-actions > .btn { display:flex; gap:6px; align-items:center; height:fit-content; }
.project-input { display:flex; flex-direction:column; gap:12px; }
.project-input input { border:1px solid #cbd5e0; border-radius:10px; padding:12px 14px; font-size:20px; letter-spacing:2px; text-align:center; min-width:220px; background:#f8fafc; color:#1f2937; }
.project-input input:focus { outline:2px solid var(--brand); }
.keypad { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
.keypad button { border:none; border-radius:12px; padding:16px 0; font-size:22px; font-weight:bold; background:#e5f0ff; color:#1f2937; cursor:pointer; transition:background 0.2s ease; }
.keypad button:active { background:#cbdafc; }
.keypad button.action { font-size:16px; font-weight:600; background:#dfe7f3; }
.keypad button.wide { grid-column: span 2; }
.empty-state { background:white; border-radius:12px; padding:40px 24px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.08); font-size:18px; color:#475569; display:none; justify-content:center; align-items:center; text-align:center; min-height:120px; }
.timeline-card { margin-top: -4px; }
.team-card, .task-card { background: white; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 16px; margin-bottom: 20px; }
.team-header, .task-header { display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 17px; margin-bottom: 10px; gap: 12px; }
.task-header-info { display: flex; flex-direction: column; gap: 4px; }
.task-schedule { font-size: 20px; font-weight: 700; color: #1d4ed8; letter-spacing:0.28px; }
.task-header-meta { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; justify-content: flex-end; }
.activity-time-summary { display:flex; flex-direction:column; align-items:flex-end; gap:2px; min-width:120px; }
.activity-time-label { font-size:11px; letter-spacing:0.4px; text-transform:uppercase; color:#64748b; font-weight:600; }
.activity-time-value { font-family:"Courier New", monospace; font-size:18px; font-weight:700; color:#0f172a; }
.team-actions { display:flex; gap:8px; align-items:center; }
.btn { border:none; border-radius:10px; padding:10px 14px; font-size:14px; color:white; cursor:pointer; display:inline-flex; align-items:center; gap:6px; }
.btn-primary{ background: var(--brand); }
.btn-toggle{ background: var(--warn); }
.btn-secondary { background: rgba(255,255,255,0.18); color:white; border:1px solid rgba(255,255,255,0.35); }
.btn-secondary.active { background: rgba(0,0,0,0.25); }
.team-member, .member-task { background: #eaf2fb; border-radius: 10px; padding: 14px; margin-bottom: 8px; cursor: pointer; user-select: none; transition: background 0.2s ease; }
.team-member.selected, .member-task.selected { background: #cce5ff; border-left: 6px solid var(--brand); }
.drop-zone { border: 2px dashed var(--brand); border-radius: 10px; padding: 10px; text-align: center; font-size: 16px; color: var(--brand); margin-top: 10px; }
.task-header-row { display: flex; justify-content: space-between; align-items: center; }
.timer-display { font-weight: bold; color: var(--brand); font-size: 16px; }
.activity-select-btn { border:none; border-radius:999px; background:#2563eb; color:#fff; padding:8px 14px; font-size:13px; font-weight:600; cursor:pointer; transition:transform 0.1s ease; touch-action: manipulation; }
.activity-select-btn:active { transform: scale(0.97); }
.activity-complete-btn { border:none; border-radius:999px; background:#16a34a; color:#fff; padding:8px 16px; font-size:13px; font-weight:700; cursor:pointer; transition:transform 0.12s ease, box-shadow 0.2s ease; touch-action: manipulation; box-shadow:0 4px 14px rgba(22,163,74,0.22); }
.activity-complete-btn:active { transform:scale(0.97); box-shadow:0 2px 8px rgba(22,163,74,0.25); }
.task-members { display:flex; flex-direction:column; gap:8px; }
.task-members .member-task { margin-bottom: 0; }
.activity-collapse-btn { border:none; border-radius:999px; background:#e2e8f0; color:#1f2937; padding:8px 14px; font-size:13px; font-weight:600; cursor:pointer; transition:transform 0.1s ease, background 0.15s ease; touch-action: manipulation; }
.activity-collapse-btn:active { transform: scale(0.97); background:#cbd5e1; }
.task-card.collapsed .activity-collapse-btn { background:#1d4ed8; color:#fff; }
.datetime-info { font-size: 20px; color: #0f172a; margin-top: 10px; display: flex; justify-content: space-between; font-weight:600; letter-spacing:0.22px; }
.datetime-info span { display:block; }
.pause-info { font-size: 12px; color: #999; margin-top: 2px; text-align:right; }
.popup { position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); background: var(--ok); color: white; padding: 16px 24px; border-radius: 12px; font-size: 18px; opacity: 0; transition: opacity 0.3s ease-in-out; z-index: 999; }
.popup.show { opacity: 1; }
.selection-toolbar { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background: rgba(15,23,42,0.92); color: #fff; padding: 16px 24px; border-radius: 28px; box-shadow: 0 10px 24px rgba(15,23,42,0.25); display: flex; flex-direction: column; align-items: center; gap: 12px; z-index: 120; transition: opacity 0.2s ease, transform 0.2s ease; max-width: min(95vw, 640px); }
.selection-toolbar.hidden { opacity: 0; pointer-events: none; transform: translate(-50%, 12px); }
.selection-count { font-weight: 600; letter-spacing: 0.4px; text-align: center; width: 100%; }
.selection-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; width: 100%; }
.selection-actions .btn { flex: 1 1 160px; justify-content: center; min-height: 46px; touch-action: manipulation; }
.selection-actions .btn:disabled { opacity: 0.45; cursor: not-allowed; }
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; align-items: center; justify-content: center; z-index: 300; padding: 16px; }
.modal-card { background: #fff; width: 94vw; max-width: 520px; max-height: 90vh; border-radius: 16px; padding: 26px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 18px; }
.modal-card h3 { margin: 0; }
.activity-search { width: 100%; padding: 12px 14px; border: 1px solid #d1d5db; border-radius: 12px; font-size: 17px; box-sizing: border-box; }
.activity-search + #choices { margin-top: 4px; }
#choices { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; padding-right: 8px; -webkit-overflow-scrolling: touch; overscroll-behavior: contain; }
.activity-search:focus { outline: 2px solid var(--brand); }
.activity-empty { padding: 18px; border-radius: 10px; background: #f8fafc; color: #475569; font-size: 15px; }
.choice { background: var(--brand); color: #fff; border: none; border-radius: 14px; padding: 18px; width: 100%; font-size: 18px; cursor: pointer; touch-action: manipulation; }
.choice:active { transform: scale(0.98); }
.btn-danger { background: var(--warn); color: #fff; border: none; padding: 18px; border-radius: 12px; width: 100%; font-size: 18px; }
.modal-open #selectionToolbar { display: none !important; }
.feedback-card { align-items:center; text-align:center; gap:20px; }
.feedback-title { font-size:22px; font-weight:700; margin:0; color:#0f172a; }
.feedback-subtitle { margin:0; font-size:15px; color:#475569; }
.feedback-activity { font-weight:700; color:#1a73e8; display:inline-block; max-width:100%; word-break:break-word; }
.feedback-stars { display:flex; justify-content:center; gap:12px; }
.feedback-star { border:none; background:transparent; font-size:36px; color:#cbd5f5; cursor:pointer; transition:transform 0.15s ease, color 0.15s ease; padding:4px; }
.feedback-star:focus { outline:2px solid #1a73e8; outline-offset:4px; }
.feedback-star:hover { color:#facc15; }
.feedback-star.active { color:#fbbf24; transform:scale(1.12); }
.feedback-rating-value { font-size:14px; font-weight:600; color:#475569; letter-spacing:0.3px; }
.feedback-actions { display:flex; flex-direction:column; gap:12px; width:100%; }
.feedback-submit { border:none; border-radius:14px; background:#1a73e8; color:#fff; padding:16px; font-size:18px; font-weight:600; cursor:pointer; transition:background 0.2s ease; }
.feedback-submit:disabled { background:#a7c5f9; cursor:not-allowed; }
.feedback-submit:not(:disabled):active { background:#1558c0; }
.feedback-cancel { border:none; background:transparent; color:#5f6368; font-size:15px; font-weight:600; cursor:pointer; }
.feedback-cancel:hover { text-decoration:underline; }
.install-prompt { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:300; width:90%; max-width:400px; }
.install-prompt-content { background:#fff; border-radius:16px; box-shadow:0 8px 24px rgba(15,23,42,0.25); padding:18px 20px; display:flex; align-items:center; gap:16px; animation:slideUp 0.3s ease; }
@keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
.install-prompt-icon { font-size:32px; }
.install-prompt-text { flex:1; display:flex; flex-direction:column; gap:2px; }
.install-prompt-text strong { font-size:16px; font-weight:700; color:#0f172a; }
.install-prompt-text span { font-size:13px; color:#64748b; }
.install-prompt-btn { border:none; background:#1a73e8; color:#fff; padding:10px 20px; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer; white-space:nowrap; }
.install-prompt-btn:active { background:#1558c0; }
.install-prompt-dismiss { border:none; background:transparent; color:#94a3b8; font-size:20px; cursor:pointer; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:50%; }
.install-prompt-dismiss:active { background:#f1f5f9; }
.timeline-overlay { position: fixed; inset: 0; background: rgba(15,23,42,0.35); z-index: 110; }
.timeline-panel { position: fixed; top: 0; right: 0; width: 340px; max-width: 90vw; height: 100vh; background: #fff; z-index: 120; box-shadow: -4px 0 18px rgba(15,23,42,0.18); transform: translateX(100%); transition: transform 0.28s ease; display: flex; flex-direction: column; }
.timeline-panel.open { transform: translateX(0); }
.timeline-header { display:flex; justify-content:space-between; align-items:center; padding:20px; border-bottom:1px solid #e2e8f0; font-weight:600; font-size:17px; color:#1f2937; }
.timeline-body { flex:1; overflow-y:auto; padding:18px 20px; display:flex; flex-direction:column; gap:12px; }
.event-list { display:flex; flex-direction:column; gap:12px; }
.event-item { background:#f4f7fb; border-radius:10px; padding:12px 16px; display:flex; justify-content:space-between; align-items:center; font-size:15px; color:#1f2937; }
.event-summary { font-weight:600; }
.event-meta { font-size:13px; color:#6b7280; margin-left:16px; white-space:nowrap; }
.event-empty { color:#6b7280; font-style:italic; text-align:center; padding:18px 0; border:1px dashed #cbd5e0; border-radius:10px; background:#f8fafc; }
</style>
</head>
<body>
<header>
<div class="header-left">
<button id="menuToggle" class="header-icon-btn" aria-label="Apri menu">‚ò∞</button>
<span class="logo-title">üî∑ JobLOG - Modalit√† Touch</span>
</div>
<div class="header-actions">
<button id="timelineBtn" class="btn btn-secondary" disabled>üïí Cronologia</button>
<span id="clock">--/--/---- | --:--</span>
</div>
</header>

<div id="menuOverlay" class="menu-overlay hidden"></div>
<nav id="sideMenu" class="side-menu" aria-hidden="true">
<div class="side-menu-header">
<div class="side-menu-brand">
<span class="side-menu-avatar">J</span>
<div class="side-menu-brand-text">
<span class="side-menu-title">JobLOG</span>
<span class="side-menu-subtitle">Modalit√† touch</span>
<span class="side-menu-release-chip">
<span class="side-menu-release-dot"></span>
<span id="menuReleaseVersion" class="side-menu-release">‚Äì</span>
</span>
</div>
</div>
<button id="menuCloseBtn" class="side-menu-close" aria-label="Chiudi menu">‚úï</button>
</div>
<div class="side-menu-body">
<div class="side-menu-section">
<span class="side-menu-section-title">Navigazione</span>
<ul class="side-menu-list">
<li>
<button class="side-menu-item" type="button" data-menu-action>
<span class="side-menu-item-icon">üè†</span>
<span class="side-menu-item-label">
<span class="side-menu-item-text">Dashboard</span>
<span class="side-menu-item-hint">Panoramica generale</span>
</span>
</button>
</li>
<li>
<button class="side-menu-item" type="button" data-menu-action>
<span class="side-menu-item-icon">‚è±Ô∏è</span>
<span class="side-menu-item-label">
<span class="side-menu-item-text">Attivit√† in corso</span>
<span class="side-menu-item-hint">Operatori e tempi live</span>
</span>
</button>
</li>
<li>
<button class="side-menu-item" type="button" data-menu-action>
<span class="side-menu-item-icon">ÔøΩ</span>
<span class="side-menu-item-label">
<span class="side-menu-item-text">Storico operazioni</span>
<span class="side-menu-item-hint">Registri e log recenti</span>
</span>
</button>
</li>
</ul>
</div>
</div>
</nav>


<div class="container">
<div class="project-bar">
<div class="project-info">
<span class="project-info-icon">üì¶ Progetto attivo:</span>
<div class="project-info-details">
<span id="projectLabel">Nessun progetto attivo</span>
<div class="project-metric">
<span class="metric-label">‚è±Ô∏è Tempo in corso</span>
<span id="totalRunningTime" class="metric-value">00:00:00</span>
</div>
</div>
</div>
<div class="project-actions">
<div id="projectInputGroup" class="project-input">
<input id="projectDateInput" type="date" placeholder="Data di riferimento" />
<input id="projectInput" type="text" placeholder="Codice pianificazione es. 1001" readonly />
<div id="projectKeypad" class="keypad hidden">
<button data-digit="1">1</button>
<button data-digit="2">2</button>
<button data-digit="3">3</button>
<button data-digit="4">4</button>
<button data-digit="5">5</button>
<button data-digit="6">6</button>
<button data-digit="7">7</button>
<button data-digit="8">8</button>
<button data-digit="9">9</button>
<button class="action" data-action="clear">Canc</button>
<button data-digit="0">0</button>
<button class="action" data-action="back">‚å´</button>
</div>
</div>
<button id="loadProjectBtn" class="btn btn-primary">üöö Carica Progetto</button>
</div>
</div>
<div id="emptyState" class="empty-state">Carica un codice numerico per iniziare la pianificazione.</div>
<div id="teamCard" class="team-card">
<div class="team-header">
<span>üë∑ Squadra</span>
</div>
<div class="member-list" id="memberList"></div>
</div>


<div id="activities"></div>
</div>

<div id="selectionToolbar" class="selection-toolbar hidden">
<span id="selectionCount" class="selection-count">0 operatori selezionati</span>
<div class="selection-actions">
<button id="selectionStartBtn" class="btn btn-primary" style="background:#16a34a;">‚ñ∂Ô∏è Avvia selezione</button>
<button id="selectionMoveBtn" class="btn btn-primary">‚û°Ô∏è Sposta sull'attivit√†</button>
<button id="selectionPauseBtn" class="btn btn-secondary">‚è∏Ô∏è Pausa selezione</button>
<button id="selectionFinishBtn" class="btn btn-danger">‚úÖ Fine attivit√†</button>
</div>
</div>


<div id="activityModal" class="modal">
<div class="modal-card">
<h3>üìç Scegli destinazione</h3>
<input id="activitySearch" class="activity-search" type="text" placeholder="Filtra attivit√†" autocomplete="off" />
<div id="choices"></div>
<button class="btn-danger" id="cancelBtn">Annulla</button>
</div>
</div>


<div id="feedbackModal" class="modal">
<div class="modal-card feedback-card">
<h3 class="feedback-title">Attivit√† completata</h3>
<p class="feedback-subtitle">Com'√® andata "<span id="feedbackActivityName" class="feedback-activity">Attivit√†</span>"?</p>
<div class="feedback-stars" role="group" aria-label="Valuta l'attivit√†">
<button type="button" class="feedback-star" data-rating="1" aria-label="1 stella su 5">‚òÖ</button>
<button type="button" class="feedback-star" data-rating="2" aria-label="2 stelle su 5">‚òÖ</button>
<button type="button" class="feedback-star" data-rating="3" aria-label="3 stelle su 5">‚òÖ</button>
<button type="button" class="feedback-star" data-rating="4" aria-label="4 stelle su 5">‚òÖ</button>
<button type="button" class="feedback-star" data-rating="5" aria-label="5 stelle su 5">‚òÖ</button>
</div>
<span id="feedbackRatingValue" class="feedback-rating-value">0/5</span>
<div class="feedback-actions">
<button id="feedbackSubmitBtn" type="button" class="feedback-submit" disabled>Salva feedback</button>
<button id="feedbackCancelBtn" type="button" class="feedback-cancel">Annulla</button>
</div>
</div>
</div>


<div id="popup" class="popup">‚úÖ Operazione eseguita</div>

<!-- PWA Install Prompt -->
<div id="installPrompt" class="install-prompt hidden">
<div class="install-prompt-content">
<div class="install-prompt-icon">üì±</div>
<div class="install-prompt-text">
<strong>Installa JobLog</strong>
<span>Accesso rapido dalla schermata home</span>
</div>
<button id="installBtn" class="install-prompt-btn">Installa</button>
<button id="dismissInstallBtn" class="install-prompt-dismiss">‚úï</button>
</div>
</div>

<div id="timelineOverlay" class="timeline-overlay hidden"></div>
<div id="timelinePanel" class="timeline-panel">
<div class="timeline-header">
<span>üïí Cronologia</span>
<button id="closeTimelineBtn" class="btn btn-secondary">Chiudi</button>
</div>
<div class="timeline-body">
<div id="eventList" class="event-list"></div>
</div>
</div>


<script src="/static/js/app.js?v=20251113a"></script>
<script>
// PWA Service Worker Registration
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/sw.js')
            .then(registration => {
                console.log('‚úì Service Worker registrato:', registration.scope);
            })
            .catch(error => {
                console.log('‚úó Service Worker fallito:', error);
            });
    });
}

// PWA Install Prompt
let deferredPrompt;
const installPrompt = document.getElementById('installPrompt');
const installBtn = document.getElementById('installBtn');
const dismissInstallBtn = document.getElementById('dismissInstallBtn');

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    
    // Check if user dismissed before
    const dismissed = localStorage.getItem('pwa-install-dismissed');
    if (!dismissed) {
        setTimeout(() => {
            if (installPrompt) {
                installPrompt.classList.remove('hidden');
            }
        }, 3000);
    }
});

if (installBtn) {
    installBtn.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('PWA install:', outcome);
        
        if (installPrompt) {
            installPrompt.classList.add('hidden');
        }
        deferredPrompt = null;
    });
}

if (dismissInstallBtn) {
    dismissInstallBtn.addEventListener('click', () => {
        if (installPrompt) {
            installPrompt.classList.add('hidden');
        }
        localStorage.setItem('pwa-install-dismissed', 'true');
    });
}

// Listen for app installed
window.addEventListener('appinstalled', () => {
    console.log('‚úì PWA installata');
    if (installPrompt) {
        installPrompt.classList.add('hidden');
    }
});
</script>
</body>
</html>